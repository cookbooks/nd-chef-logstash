input {
  <% if node['logstash']['server']['inputs'].empty? -%>
  tcp {
    type => "tcp-input"
    port => "5959"
    format => "json_event"
  }
<<<<<<< HEAD
  <% else %>    
    <% node['logstash']['server']['inputs'].each do |input| -%>
     
        <% input.each do |name,hash| -%> 
             <%= name %> {
                 <% hash.each do |k,v| -%>         
                    <% case v.class.to_s -%>
                    <% when "Array" -%>
                       <%= k %> => <%= v.inspect %>
                    <% else -%>
                       <%= k %> => '<%= v %>'
                    <% end -%>
                 <% end -%>
        <% end -%>
        }
     <% end -%>
=======
  <% else -%> 
    <%= LogstashConf.section_to_str(node['logstash']['server']['inputs']) %>
>>>>>>> upstream/master
  <% end -%>
}

<% unless node['logstash']['server']['filters'].empty? -%>
filter {
<<<<<<< HEAD
   <% node['logstash']['server']['filters'].each do |filter| -%>
      <% filter.each do |name,hash| -%> 
         <%= name %> {
             <% hash.each do |k,v| -%>         
                <% case v.class.to_s -%>
                <% when "Array" -%>
                   <%= k %> => <%= v.inspect %>
                <% else -%>
                   <%= k %> => '<%= v %>'
                <% end -%>
           <% end -%>
      <% end -%>
              }
   <% end -%>
=======
  <%= LogstashConf.section_to_str(node['logstash']['server']['filters']) %>
>>>>>>> upstream/master
}
<% end -%>

output {
  <% if node['logstash']['server']['debug'] -%>
  stdout { debug => true debug_format => "json" }
  <% end -%>
  <% if @enable_embedded_es -%>
  elasticsearch { embedded => true }
  <% elsif not @es_server_ip.empty? -%>
  elasticsearch { host => "<%= @es_server_ip %>" cluster => "<%= @es_cluster %>" }
  <% end -%>
  <% unless @graphite_server_ip.empty? -%>
  graphite { host => "<%= @graphite_server_ip %>" metrics => ["logstash.events", "1"] }
  <% end -%>
  <% # unless node['logstash']['server']['outputs'].empty? -%>
    <%= LogstashConf.section_to_str(node['logstash']['server']['outputs']) %>
  <% # end -%>
}
